<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tatanka Strength</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="20-Week Strength Training Program Tracker">
    <meta name="theme-color" content="#CC5500">
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS Specific Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Tatanka Strength">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #001f3f 0%, #003366 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #CC5500 0%, #ff6a00 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header img {
            max-width: 200px;
            height: auto;
            margin-bottom: 10px;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: #f8f9fa;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            color: #495057;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: white;
            color: #CC5500;
            border-bottom: 3px solid #CC5500;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        /* Workout Tracker Styles */
        .controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .controls label {
            font-weight: 600;
            color: #495057;
        }

        .controls select {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            cursor: pointer;
        }

        .week-info {
            background: #001f3f;
            border-left: 4px solid #CC5500;
            padding: 15px 20px;
            margin-bottom: 25px;
            border-radius: 8px;
        }

        .week-info h2 {
            color: white;
            font-size: 24px;
            margin-bottom: 8px;
        }

        .week-info p {
            color: rgba(255, 255, 255, 0.9);
        }

        /* Watermark Background - Fixed behind exercises */
        #exercisesContainer {
            position: relative;
        }

        #exercisesContainer::before {
            content: '';
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: 400px;
            background-image: url('IconOnly_Transparent__Watermark.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0.08;
            pointer-events: none;
            z-index: 0;
        }

        .exercise-card {
            position: relative;
            z-index: 1;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .exercise-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .exercise-card.completed {
            border-color: #28a745;
            background: #f8fff9;
        }

        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .toggle-switch {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            user-select: none;
        }

        .toggle-switch input {
            display: none;
        }

        .toggle-slider {
            position: relative;
            width: 50px;
            height: 26px;
            background: #ccc;
            border-radius: 13px;
            transition: background 0.3s;
        }

        .toggle-slider:before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            top: 3px;
            left: 3px;
            transition: transform 0.3s;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: #28a745;
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .toggle-label {
            font-size: 14px;
            font-weight: 600;
            color: #495057;
        }

        .exercise-name {
            font-size: 18px;
            font-weight: 700;
            color: #001f3f;
        }

        .exercise-details {
            font-size: 14px;
            color: #6c757d;
            margin-top: 5px;
        }

        .dial-container {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }

        .dial {
            flex: 1;
            text-align: center;
        }

        .dial-label {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .dial-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .dial-button {
            width: 40px;
            height: 40px;
            border: 2px solid #CC5500;
            background: white;
            color: #CC5500;
            border-radius: 50%;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        .dial-button:hover {
            background: #CC5500;
            color: white;
        }

        .dial-button:active,
        .dial-button.pressing {
            background: #CC5500;
            color: white;
            transform: scale(0.9);
        }

        .dial-value {
            font-size: 24px;
            font-weight: bold;
            color: #001f3f;
            min-width: 60px;
        }

        /* Calendar Styles */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-header h3 {
            font-size: 24px;
            color: #001f3f;
        }

        .month-nav {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .month-nav button {
            padding: 8px 15px;
            background: #CC5500;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .month-nav button:hover {
            background: #ff6a00;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 30px;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: 700;
            color: #001f3f;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 8px;
            text-align: center;
            background: white;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }

        .calendar-day:hover {
            border-color: #CC5500;
            box-shadow: 0 2px 8px rgba(204, 85, 0, 0.2);
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        .calendar-day.today {
            border-color: #001f3f;
            border-width: 3px;
        }

        .calendar-day.has-workout {
            background: linear-gradient(135deg, #CC5500 0%, #ff6a00 100%);
            color: white;
            border-color: #CC5500;
        }

        .calendar-day.selected {
            border-color: #001f3f;
            border-width: 3px;
            box-shadow: 0 0 0 2px #CC5500;
        }

        .calendar-day-number {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .calendar-day-workout {
            font-size: 10px;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.3);
            padding: 2px 4px;
            border-radius: 4px;
            margin-top: 4px;
        }

        .workout-log {
            margin-top: 30px;
        }

        .workout-log h4 {
            color: #001f3f;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .workout-log-entry {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #CC5500;
            transition: all 0.2s;
        }

        .workout-log-entry:hover {
            background: #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transform: translateX(2px);
        }

        .workout-log-date {
            font-weight: 700;
            color: #001f3f;
            margin-bottom: 5px;
        }

        .workout-log-details {
            color: #6c757d;
            font-size: 14px;
        }

        /* Trends Styles */
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #28a745;
            color: white;
        }

        .btn-primary:hover {
            background: #218838;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .notes-area {
            position: relative;
            z-index: 1;
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            margin-top: 15px;
            resize: vertical;
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Trends Overview Stats */
        .trends-overview {
            background: linear-gradient(135deg, #001f3f 0%, #003366 100%);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .trends-overview h3 {
            color: white;
            margin-bottom: 20px;
            font-size: 22px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #CC5500;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.9);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-change {
            font-size: 12px;
            color: #4CAF50;
            margin-top: 5px;
        }

        /* Goal Progress Circles */
        .goals-section {
            margin-top: 30px;
        }

        .goals-section h4 {
            color: white;
            margin-bottom: 20px;
            font-size: 18px;
        }

        .goals-grid {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .goal-circle {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .circle-container {
            position: relative;
            width: 120px;
            height: 120px;
        }

        .circle-svg {
            transform: rotate(-90deg);
        }

        .circle-bg {
            fill: none;
            stroke: rgba(255, 255, 255, 0.1);
            stroke-width: 10;
        }

        .circle-progress {
            fill: none;
            stroke-width: 10;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease;
        }

        .circle-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .circle-percent {
            font-size: 24px;
            font-weight: bold;
            color: white;
        }

        .circle-current {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 2px;
        }

        .goal-label {
            color: white;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
        }

        /* Heaviest Lifts Section */
        .heaviest-lifts {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .heaviest-lifts h3 {
            color: #001f3f;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .heaviest-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }

        .heaviest-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #CC5500;
        }

        .heaviest-exercise {
            font-size: 14px;
            font-weight: 600;
            color: #001f3f;
            margin-bottom: 5px;
        }

        .heaviest-weight {
            font-size: 20px;
            font-weight: bold;
            color: #CC5500;
        }

        .heaviest-date {
            font-size: 11px;
            color: #6c757d;
            margin-top: 3px;
        }

        /* Update Banner */
        .update-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #CC5500 0%, #ff6a00 100%);
            color: white;
            padding: 15px 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: space-between;
            animation: slideDown 0.3s ease;
        }

        .update-banner.show {
            display: flex;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .update-message {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .update-icon {
            font-size: 24px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.2);
            }
        }

        .update-button {
            background: white;
            color: #CC5500;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .update-button:hover {
            background: #f0f0f0;
            transform: scale(1.05);
        }

        .update-button:active {
            transform: scale(0.95);
        }

        .legend-color {
            width: 40px;
            height: 3px;
            border-radius: 2px;
        }

        /* Mobile Responsive Styles - iPhone Portrait */
        @media only screen and (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 15px;
            }

            .header {
                padding: 20px 15px;
            }

            .header img {
                max-width: 150px;
            }

            .header h1 {
                font-size: 22px;
            }

            .header p {
                font-size: 14px;
            }

            .tab {
                padding: 12px 8px;
                font-size: 14px;
            }

            .tab-content {
                padding: 15px;
            }

            /* Controls - Stack vertically on mobile */
            .controls {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }

            .controls > div {
                width: 100%;
            }

            .controls select {
                width: 100%;
            }

            /* Week info */
            .week-info {
                padding: 12px 15px;
            }

            .week-info h2 {
                font-size: 20px;
            }

            .week-info p {
                font-size: 14px;
            }

            /* Exercise cards */
            .exercise-card {
                padding: 15px;
            }

            .exercise-name {
                font-size: 16px;
            }

            .exercise-details {
                font-size: 13px;
            }

            /* Dials - Stack vertically on mobile */
            .dial-container {
                flex-direction: column;
                gap: 15px;
            }

            .dial {
                width: 100%;
            }

            .toggle-label {
                font-size: 13px;
            }

            .toggle-slider {
                width: 44px;
                height: 24px;
            }

            .toggle-slider:before {
                width: 18px;
                height: 18px;
            }

            .toggle-switch input:checked + .toggle-slider:before {
                transform: translateX(20px);
            }

            .dial-button {
                width: 45px;
                height: 45px;
                font-size: 24px;
            }

            .dial-value {
                font-size: 28px;
                min-width: 80px;
            }

            /* Action buttons */
            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                padding: 14px;
            }

            /* Notes area */
            .notes-area {
                font-size: 16px;
                min-height: 80px;
            }

            /* Trends Overview */
            .trends-overview {
                padding: 15px;
            }

            .trends-overview h3 {
                font-size: 18px;
                margin-bottom: 15px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .stat-card {
                padding: 15px;
            }

            .stat-value {
                font-size: 24px;
            }

            .stat-label {
                font-size: 11px;
            }

            .goals-grid {
                gap: 20px;
            }

            .circle-container {
                width: 100px;
                height: 100px;
            }

            .circle-percent {
                font-size: 20px;
            }

            .circle-current {
                font-size: 10px;
            }

            .goal-label {
                font-size: 13px;
            }

            .heaviest-lifts {
                padding: 15px;
            }

            .heaviest-lifts h3 {
                font-size: 18px;
            }

            .heaviest-grid {
                grid-template-columns: 1fr;
            }

            /* Update Banner - Mobile */
            .update-banner {
                padding: 12px 15px;
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }

            .update-message {
                justify-content: center;
                font-size: 14px;
            }

            .update-button {
                width: 100%;
                padding: 12px;
            }

            /* Calendar */
            .calendar-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .calendar-header h3 {
                font-size: 20px;
                text-align: center;
            }

            .month-nav {
                justify-content: center;
            }

            .calendar-grid {
                gap: 5px;
            }

            .calendar-day {
                padding: 5px;
                min-height: 60px;
            }

            .calendar-day-number {
                font-size: 14px;
            }

            .calendar-day-workout {
                font-size: 9px;
            }

            /* Trends */
        }

        /* Extra small devices - iPhone SE and similar */
        @media only screen and (max-width: 375px) {
            .header h1 {
                font-size: 20px;
            }

            .header p {
                font-size: 13px;
            }

            .tab {
                font-size: 12px;
                padding: 10px 5px;
            }

            .dial-button {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }

            .dial-value {
                font-size: 24px;
                min-width: 70px;
            }

            .calendar-day {
                min-height: 50px;
            }
        }
    </style>
</head>
<body>
    <!-- Update Notification Banner -->
    <div id="updateBanner" class="update-banner">
        <div class="update-message">
            <span class="update-icon">üéâ</span>
            <span>New version available!</span>
        </div>
        <button class="update-button" onclick="applyUpdate()">Update Now</button>
    </div>

    <div class="container">
        <div class="header">
            <img src="logo-header.png" alt="Tatanka Strength" style="max-width: 200px; height: auto; margin-bottom: 10px;">
            <p>20-Week Program ‚Ä¢ Bench: 185‚Üí225 lbs ‚Ä¢ Squat: 225‚Üí300 lbs</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('tracker')">üèãÔ∏è Workout</button>
            <button class="tab" onclick="switchTab('calendar')">üìÖ Calendar</button>
            <button class="tab" onclick="switchTab('progress')">üìà Progress</button>
        </div>

        <!-- WORKOUT TRACKER TAB -->
        <div id="tracker" class="tab-content active">
            <div class="controls">
                <div>
                    <label>Week:</label>
                    <select id="weekSelect" onchange="updateWorkout()"></select>
                </div>
                <div>
                    <label>Workout Day:</label>
                    <select id="daySelect" onchange="updateWorkout()"></select>
                </div>
            </div>

            <div class="week-info">
                <h2 id="workoutTitle"></h2>
                <p id="workoutSubtitle"></p>
                <p id="selectedDateInfo" style="margin-top: 8px; font-size: 14px; color: rgba(255,255,255,0.8);"></p>
            </div>

            <div id="exercisesContainer"></div>

            <textarea class="notes-area" id="workoutNotes" placeholder="Workout notes..." onchange="updateNotes(this.value)"></textarea>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="saveWorkout()">üíæ Save Progress</button>
                <button class="btn btn-primary" onclick="markWorkoutComplete()">‚úÖ Complete Workout</button>
                <button class="btn btn-secondary" onclick="clearSelectedDate()" id="clearDateBtn" style="display:none;">üìÖ Log Today Instead</button>
                <button class="btn btn-secondary" onclick="clearWorkout()">üóëÔ∏è Clear Workout</button>
            </div>
        </div>

        <!-- CALENDAR TAB -->
        <div id="calendar" class="tab-content">
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #CC5500;">
                <strong>üìÖ How to use Calendar:</strong><br>
                ‚Ä¢ <strong>Click any date</strong> to log a workout for that day<br>
                ‚Ä¢ Orange dates = workouts already logged<br>
                ‚Ä¢ Bold border = today<br>
                ‚Ä¢ Double border = selected date for logging
            </div>

            <div class="calendar-header">
                <h3 id="calendarMonth"></h3>
                <div class="month-nav">
                    <button onclick="changeMonth(-1)">‚óÄ Prev</button>
                    <button onclick="changeMonth(0)">Today</button>
                    <button onclick="changeMonth(1)">Next ‚ñ∂</button>
                </div>
            </div>

            <div class="calendar-grid" id="calendarGrid"></div>

            <div class="workout-log">
                <h4>Recent Workouts</h4>
                <div id="workoutLogList"></div>
            </div>
        </div>

        <!-- PROGRESS TAB -->
        <div id="progress" class="tab-content">
            <!-- Overview Stats -->
            <div class="trends-overview">
                <h3>Overview</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalWorkouts">0</div>
                        <div class="stat-label">Workouts</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalLifted">0</div>
                        <div class="stat-label">Lifted (tons)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalReps">0</div>
                        <div class="stat-label">Reps</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalSets">0</div>
                        <div class="stat-label">Sets</div>
                    </div>
                </div>

                <!-- Goal Progress -->
                <div class="goals-section">
                    <h4>üéØ My Goals</h4>
                    <div class="goals-grid">
                        <div class="goal-circle">
                            <div class="circle-container">
                                <svg class="circle-svg" width="120" height="120">
                                    <circle class="circle-bg" cx="60" cy="60" r="52"></circle>
                                    <circle class="circle-progress" cx="60" cy="60" r="52" 
                                            id="benchCircle" 
                                            stroke="#ff6a00"
                                            stroke-dasharray="326.73"
                                            stroke-dashoffset="326.73"></circle>
                                </svg>
                                <div class="circle-text">
                                    <div class="circle-percent" id="benchPercent">0%</div>
                                    <div class="circle-current" id="benchCurrent">0 lbs</div>
                                </div>
                            </div>
                            <div class="goal-label">Bench Press 225 lbs</div>
                        </div>
                        
                        <div class="goal-circle">
                            <div class="circle-container">
                                <svg class="circle-svg" width="120" height="120">
                                    <circle class="circle-bg" cx="60" cy="60" r="52"></circle>
                                    <circle class="circle-progress" cx="60" cy="60" r="52" 
                                            id="squatCircle"
                                            stroke="#CC5500"
                                            stroke-dasharray="326.73"
                                            stroke-dashoffset="326.73"></circle>
                                </svg>
                                <div class="circle-text">
                                    <div class="circle-percent" id="squatPercent">0%</div>
                                    <div class="circle-current" id="squatCurrent">0 lbs</div>
                                </div>
                            </div>
                            <div class="goal-label">Back Squat 300 lbs</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Heaviest Lifts (Last 90 Days) -->
            <div class="heaviest-lifts">
                <h3>Max Efforts (Last 90 Days)</h3>
                <div class="heaviest-grid" id="heaviestGrid">
                    <div style="text-align: center; color: #6c757d; grid-column: 1/-1;">
                        Complete workouts to track your heaviest lifts
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Program data structure
        const programData = {
            1: {
                phase: "Foundation",
                workouts: {
                    A: {
                        focus: "Upper Body",
                        exercises: [
                            { name: "Bench Press", sets: "4x8", weight: "130 lbs", reps: 8 },
                            { name: "Incline Dumbbell Press", sets: "3x10", weight: "35 lbs each", reps: 10 },
                            { name: "Close-Grip Bench Press", sets: "3x8", weight: "110 lbs", reps: 8 },
                            { name: "Barbell Rows", sets: "4x8", weight: "135 lbs", reps: 8 },
                            { name: "Lat Pulldowns", sets: "3x10", weight: "120 lbs", reps: 10 },
                            { name: "Dumbbell Shoulder Press", sets: "3x10", weight: "30 lbs each", reps: 10 },
                            { name: "Dumbbell Curls", sets: "3x12", weight: "25 lbs each", reps: 12 },
                            { name: "Plank", sets: "3x60s", weight: "60 sec", reps: 1 }
                        ]
                    },
                    B: {
                        focus: "Lower Body",
                        exercises: [
                            { name: "Back Squat", sets: "4x8", weight: "160 lbs", reps: 8 },
                            { name: "Romanian Deadlift", sets: "3x8", weight: "185 lbs", reps: 8 },
                            { name: "Leg Press", sets: "3x12", weight: "270 lbs", reps: 12 },
                            { name: "Bulgarian Split Squats", sets: "3x10 each", weight: "30 lbs each", reps: 10 },
                            { name: "Leg Curls", sets: "3x12", weight: "80 lbs", reps: 12 },
                            { name: "Calf Raises", sets: "4x15", weight: "135 lbs", reps: 15 },
                            { name: "Ab Wheel Rollouts", sets: "3x10", weight: "bodyweight", reps: 10 }
                        ]
                    }
                }
            }
        };

        // Clone week 1 for all 20 weeks (can be customized later)
        for (let i = 2; i <= 20; i++) {
            let phase = "Foundation";
            if (i >= 5 && i <= 8) phase = "Hypertrophy";
            else if (i >= 9 && i <= 12) phase = "Strength Building";
            else if (i >= 13 && i <= 16) phase = "Power Development";
            else if (i >= 17) phase = "Peaking";
            
            programData[i] = {
                phase: phase,
                workouts: JSON.parse(JSON.stringify(programData[1].workouts))
            };
        }

        let workoutData = {};
        let completedWorkouts = {}; // { "2025-11-15": { week: 1, day: "A" } }
        let currentWeek = 1;
        let currentDay = 'A';
        let currentCalendarDate = new Date();
        let selectedWorkoutDate = null; // For logging workouts on specific dates

        // Get today's date in user's local timezone (Minneapolis)
        function getTodayLocalDate() {
            const now = new Date();
            return new Date(now.getFullYear(), now.getMonth(), now.getDate());
        }

        // Format date as YYYY-MM-DD in local timezone
        function formatLocalDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function initializeApp() {
            loadProgress();
            populateWeekSelect();
            updateWorkout();
            renderCalendar();
            updateWorkoutLog();
        }

        function populateWeekSelect() {
            const select = document.getElementById('weekSelect');
            for (let i = 1; i <= 20; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Week ${i}`;
                select.appendChild(option);
            }
            select.value = currentWeek;
        }


        function updateWorkout() {
            const weekSelect = document.getElementById('weekSelect');
            const daySelect = document.getElementById('daySelect');
            
            currentWeek = parseInt(weekSelect.value);
            currentDay = daySelect.value || 'A';

            // Update day select options
            if (daySelect.options.length === 0) {
                ['A', 'B'].forEach(day => {
                    const option = document.createElement('option');
                    option.value = day;
                    option.textContent = `Workout ${day}`;
                    daySelect.appendChild(option);
                });
            }

            const weekData = programData[currentWeek];
            const workoutInfo = weekData.workouts[currentDay];

            document.getElementById('workoutTitle').textContent = 
                `Week ${currentWeek} - ${weekData.phase}, Workout ${currentDay}`;
            document.getElementById('workoutSubtitle').textContent = 
                `Focus: ${workoutInfo.focus}`;

            // Show selected date info
            const dateInfoEl = document.getElementById('selectedDateInfo');
            const clearDateBtn = document.getElementById('clearDateBtn');
            
            if (selectedWorkoutDate) {
                const dateObj = new Date(selectedWorkoutDate + 'T00:00:00');
                const formattedDate = dateObj.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    month: 'long', 
                    day: 'numeric',
                    year: 'numeric'
                });
                dateInfoEl.textContent = `üìÖ Logging workout for: ${formattedDate}`;
                dateInfoEl.style.display = 'block';
                clearDateBtn.style.display = 'inline-block';
            } else {
                dateInfoEl.textContent = 'üí° Tip: Click a date in the Calendar tab to log a past workout';
                dateInfoEl.style.display = 'block';
                clearDateBtn.style.display = 'none';
            }

            renderExercises(workoutInfo.exercises);
            loadWorkoutData();
        }

        function renderExercises(exercises) {
            const container = document.getElementById('exercisesContainer');
            container.innerHTML = '';

            exercises.forEach((exercise, index) => {
                const card = document.createElement('div');
                card.className = 'exercise-card';
                card.id = `exercise-${index}`;

                const isPlank = exercise.name.toLowerCase().includes('plank');
                const weightLabel = isPlank ? 'Time (sec)' : 'Weight (lbs)';
                const weightIncrement = isPlank ? 5 : 5;

                card.innerHTML = `
                    <div class="exercise-header">
                        <div style="flex: 1;">
                            <div class="exercise-name">${exercise.name}</div>
                            <div class="exercise-details">Target: ${exercise.sets}</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="include-${index}" onchange="toggleExercise(${index})" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">Include</span>
                        </label>
                    </div>
                    <div class="dial-container" id="dials-${index}">
                        <div class="dial">
                            <div class="dial-label">${weightLabel}</div>
                            <div class="dial-controls">
                                <button class="dial-button" data-index="${index}" data-field="weight" data-change="-${weightIncrement}">‚àí</button>
                                <div class="dial-value" id="weight-${index}">0</div>
                                <button class="dial-button" data-index="${index}" data-field="weight" data-change="${weightIncrement}">+</button>
                            </div>
                        </div>
                        <div class="dial">
                            <div class="dial-label">Reps</div>
                            <div class="dial-controls">
                                <button class="dial-button" data-index="${index}" data-field="reps" data-change="-1">‚àí</button>
                                <div class="dial-value" id="reps-${index}">0</div>
                                <button class="dial-button" data-index="${index}" data-field="reps" data-change="1">+</button>
                            </div>
                        </div>
                        <div class="dial">
                            <div class="dial-label">Sets</div>
                            <div class="dial-controls">
                                <button class="dial-button" data-index="${index}" data-field="sets" data-change="-1">‚àí</button>
                                <div class="dial-value" id="sets-${index}">0</div>
                                <button class="dial-button" data-index="${index}" data-field="sets" data-change="1">+</button>
                            </div>
                        </div>
                    </div>
                `;

                container.appendChild(card);

                // Add tap-and-hold event listeners to all dial buttons in this card
                const buttons = card.querySelectorAll('.dial-button');
                buttons.forEach(button => {
                    setupTapAndHold(button);
                });
            });
        }

        function loadWorkoutData() {
            const workoutKey = `week${currentWeek}_day${currentDay}`;
            const data = workoutData[workoutKey] || {};
            
            const weekData = programData[currentWeek];
            const exercises = weekData.workouts[currentDay].exercises;

            exercises.forEach((exercise, index) => {
                const exerciseData = data[index] || { weight: 0, reps: 0, sets: 0, included: true };
                
                // Set weight, reps, sets values
                document.getElementById(`weight-${index}`).textContent = exerciseData.weight || 0;
                document.getElementById(`reps-${index}`).textContent = exerciseData.reps || 0;
                document.getElementById(`sets-${index}`).textContent = exerciseData.sets || 0;
                
                // Set included toggle
                const includeCheckbox = document.getElementById(`include-${index}`);
                if (includeCheckbox) {
                    includeCheckbox.checked = exerciseData.included !== false;
                    toggleExerciseVisuals(index, includeCheckbox.checked);
                }

                // Mark as completed if weight > 0 and included
                if (exerciseData.weight > 0 && exerciseData.included !== false) {
                    document.getElementById(`exercise-${index}`).classList.add('completed');
                } else {
                    document.getElementById(`exercise-${index}`).classList.remove('completed');
                }
            });

            document.getElementById('workoutNotes').value = data.notes || '';
        }

        function toggleExercise(index) {
            const workoutKey = `week${currentWeek}_day${currentDay}`;
            if (!workoutData[workoutKey]) workoutData[workoutKey] = {};
            if (!workoutData[workoutKey][index]) workoutData[workoutKey][index] = { weight: 0 };
            
            const includeCheckbox = document.getElementById(`include-${index}`);
            const isIncluded = includeCheckbox.checked;
            
            workoutData[workoutKey][index].included = isIncluded;
            toggleExerciseVisuals(index, isIncluded);
            
            // Update completed status
            if (isIncluded && workoutData[workoutKey][index].weight > 0) {
                document.getElementById(`exercise-${index}`).classList.add('completed');
            } else {
                document.getElementById(`exercise-${index}`).classList.remove('completed');
            }
            
            saveProgress();
        }

        function toggleExerciseVisuals(index, isIncluded) {
            const card = document.getElementById(`exercise-${index}`);
            const dials = document.getElementById(`dials-${index}`);
            
            if (isIncluded) {
                card.style.opacity = '1';
                if (dials) dials.style.display = 'flex';
            } else {
                card.style.opacity = '0.5';
                if (dials) dials.style.display = 'none';
            }
        }

        // Tap-and-hold system for dial buttons
        let holdInterval = null;
        let holdTimeout = null;
        let repeatDelay = 150; // Initial delay between increments
        let holdStartTime = 0;

        function setupTapAndHold(button) {
            const index = parseInt(button.dataset.index);
            const field = button.dataset.field;
            const change = parseInt(button.dataset.change);

            // Prevent zoom on double-tap
            button.addEventListener('touchstart', (e) => {
                e.preventDefault(); // Prevent default touch behavior including zoom
            }, { passive: false });

            // Mouse events (desktop)
            button.addEventListener('mousedown', (e) => {
                e.preventDefault();
                startHold(button, index, field, change);
            });

            button.addEventListener('mouseup', () => {
                stopHold(button);
            });

            button.addEventListener('mouseleave', () => {
                stopHold(button);
            });

            // Touch events (mobile)
            button.addEventListener('touchstart', (e) => {
                e.preventDefault();
                startHold(button, index, field, change);
            }, { passive: false });

            button.addEventListener('touchend', () => {
                stopHold(button);
            });

            button.addEventListener('touchcancel', () => {
                stopHold(button);
            });
        }

        function startHold(button, index, field, change) {
            button.classList.add('pressing');
            holdStartTime = Date.now();

            // First immediate adjustment
            adjustValue(index, field, change);

            // Start continuous adjustment after short delay
            holdTimeout = setTimeout(() => {
                holdInterval = setInterval(() => {
                    adjustValue(index, field, change);
                    
                    // Speed up after holding for a while
                    const holdDuration = Date.now() - holdStartTime;
                    if (holdDuration > 2000) {
                        repeatDelay = 50; // Very fast after 2 seconds
                    } else if (holdDuration > 1000) {
                        repeatDelay = 100; // Fast after 1 second
                    }
                }, repeatDelay);
            }, 500); // Start repeating after 500ms hold
        }

        function stopHold(button) {
            button.classList.remove('pressing');
            
            if (holdTimeout) {
                clearTimeout(holdTimeout);
                holdTimeout = null;
            }
            
            if (holdInterval) {
                clearInterval(holdInterval);
                holdInterval = null;
            }
            
            // Reset speed
            repeatDelay = 150;
        }

        function adjustValue(index, field, change) {
            const workoutKey = `week${currentWeek}_day${currentDay}`;
            if (!workoutData[workoutKey]) workoutData[workoutKey] = {};
            if (!workoutData[workoutKey][index]) workoutData[workoutKey][index] = { weight: 0, reps: 0, sets: 0, included: true };

            let currentValue = workoutData[workoutKey][index][field] || 0;
            currentValue += change;

            const weekData = programData[currentWeek];
            const exercise = weekData.workouts[currentDay].exercises[index];
            const isPlank = exercise.name.toLowerCase().includes('plank');

            // Apply limits
            if (field === 'weight') {
                const maxValue = isPlank ? 300 : 350;
                if (currentValue < 0) currentValue = 0;
                if (currentValue > maxValue) currentValue = maxValue;
            } else if (field === 'reps') {
                if (currentValue < 0) currentValue = 0;
                if (currentValue > 20) currentValue = 20;
            } else if (field === 'sets') {
                if (currentValue < 0) currentValue = 0;
                if (currentValue > 10) currentValue = 10;
            }

            workoutData[workoutKey][index][field] = currentValue;
            document.getElementById(`${field}-${index}`).textContent = currentValue;

            // Update completed status (only if included)
            const includeCheckbox = document.getElementById(`include-${index}`);
            const isIncluded = includeCheckbox ? includeCheckbox.checked : true;
            const exerciseData = workoutData[workoutKey][index];
            
            if (exerciseData.weight > 0 && isIncluded) {
                document.getElementById(`exercise-${index}`).classList.add('completed');
            } else {
                document.getElementById(`exercise-${index}`).classList.remove('completed');
            }

            saveProgress();
        }

        function updateNotes(value) {
            const workoutKey = `week${currentWeek}_day${currentDay}`;
            if (!workoutData[workoutKey]) workoutData[workoutKey] = {};
            workoutData[workoutKey].notes = value;
            saveProgress();
        }

        function saveWorkout() {
            saveProgress();
            alert('‚úÖ Progress saved successfully!');
        }

        function clearWorkout() {
            if (confirm('Are you sure you want to clear this workout? This cannot be undone.')) {
                const workoutKey = `week${currentWeek}_day${currentDay}`;
                delete workoutData[workoutKey];
                saveProgress();
                updateWorkout();
            }
        }

        function clearSelectedDate() {
            selectedWorkoutDate = null;
            updateWorkout();
            renderCalendar();
            alert('üìÖ Cleared! Now logging workouts for today.');
        }

        function markWorkoutComplete() {
            // Use selected date or today's date in local timezone
            const workoutDate = selectedWorkoutDate || formatLocalDate(getTodayLocalDate());
            
            completedWorkouts[workoutDate] = {
                week: currentWeek,
                day: currentDay,
                date: workoutDate
            };
            
            saveProgress();
            renderCalendar();
            updateWorkoutLog();
            
            const dateObj = new Date(workoutDate + 'T00:00:00');
            const formattedDate = dateObj.toLocaleDateString('en-US', { 
                weekday: 'short', 
                month: 'short', 
                day: 'numeric'
            });
            
            alert(`‚úÖ Workout marked as complete for ${formattedDate}!`);
            
            // Clear selected date after saving
            if (selectedWorkoutDate) {
                selectedWorkoutDate = null;
                updateWorkout(); // Refresh to clear date info
            }
        }

        function saveProgress() {
            localStorage.setItem('workoutTrackerData', JSON.stringify(workoutData));
            localStorage.setItem('completedWorkouts', JSON.stringify(completedWorkouts));
        }

        function loadProgress() {
            const saved = localStorage.getItem('workoutTrackerData');
            if (saved) workoutData = JSON.parse(saved);
            
            const completed = localStorage.getItem('completedWorkouts');
            if (completed) completedWorkouts = JSON.parse(completed);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Find and activate the clicked tab
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach((tab, index) => {
                if ((tabName === 'tracker' && index === 0) ||
                    (tabName === 'calendar' && index === 1) ||
                    (tabName === 'progress' && index === 2)) {
                    tab.classList.add('active');
                }
            });
            
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'calendar') {
                renderCalendar();
                updateWorkoutLog();
            } else if (tabName === 'progress') {
                updateProgress();
            }
        }

        // Calendar functions
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();

            document.getElementById('calendarMonth').textContent = 
                currentCalendarDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

            // Day headers
            ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                grid.appendChild(header);
            });

            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();

            // Today in local timezone
            const today = formatLocalDate(getTodayLocalDate());

            // Previous month days
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = daysInPrevMonth - i;
                const dayDiv = createCalendarDay(day, true, year, month - 1);
                grid.appendChild(dayDiv);
            }

            // Current month days
            for (let day = 1; day <= daysInMonth; day++) {
                const dayDiv = createCalendarDay(day, false, year, month);
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                if (dateStr === today) {
                    dayDiv.classList.add('today');
                }

                if (selectedWorkoutDate === dateStr) {
                    dayDiv.classList.add('selected');
                }

                if (completedWorkouts[dateStr]) {
                    dayDiv.classList.add('has-workout');
                    const workout = completedWorkouts[dateStr];
                    const workoutLabel = document.createElement('div');
                    workoutLabel.className = 'calendar-day-workout';
                    workoutLabel.textContent = `W${workout.week}${workout.day}`;
                    dayDiv.appendChild(workoutLabel);
                }

                // Make clickable
                dayDiv.onclick = () => selectDate(dateStr);

                grid.appendChild(dayDiv);
            }

            // Next month days
            const remainingDays = 42 - (firstDay + daysInMonth);
            for (let day = 1; day <= remainingDays; day++) {
                const dayDiv = createCalendarDay(day, true, year, month + 1);
                grid.appendChild(dayDiv);
            }
        }

        function createCalendarDay(day, otherMonth, year, month) {
            const dayDiv = document.createElement('div');
            dayDiv.className = 'calendar-day';
            if (otherMonth) dayDiv.classList.add('other-month');

            const dayNumber = document.createElement('div');
            dayNumber.className = 'calendar-day-number';
            dayNumber.textContent = day;
            dayDiv.appendChild(dayNumber);

            return dayDiv;
        }

        function changeMonth(direction) {
            if (direction === 0) {
                currentCalendarDate = new Date();
            } else {
                currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
            }
            renderCalendar();
        }

        function selectDate(dateStr) {
            selectedWorkoutDate = dateStr;
            
            // Format date for display
            const dateObj = new Date(dateStr + 'T00:00:00');
            const formattedDate = dateObj.toLocaleDateString('en-US', { 
                weekday: 'long', 
                month: 'long', 
                day: 'numeric',
                year: 'numeric'
            });

            // Show confirmation and switch to workout tab
            const existingWorkout = completedWorkouts[dateStr];
            let message = `Selected: ${formattedDate}\n\n`;
            
            if (existingWorkout) {
                message += `You already logged Week ${existingWorkout.week}, Workout ${existingWorkout.day} on this date.\n\n`;
                message += `Do you want to:\n`;
                message += `‚Ä¢ Update this workout (OK)\n`;
                message += `‚Ä¢ Cancel (Cancel)`;
            } else {
                message += `Select the Week and Workout you did on this date in the Workout tab.`;
            }

            if (confirm(message)) {
                // If there's an existing workout, load it
                if (existingWorkout) {
                    currentWeek = existingWorkout.week;
                    currentDay = existingWorkout.day;
                    document.getElementById('weekSelect').value = currentWeek;
                    document.getElementById('daySelect').value = currentDay;
                }
                
                // Switch to workout tab
                switchTab('tracker');
                document.querySelector('.tab').click(); // Activate workout tab visually
                updateWorkout();
                renderCalendar(); // Re-render to show selected state
            } else {
                selectedWorkoutDate = null;
            }
        }

        function updateWorkoutLog() {
            const logList = document.getElementById('workoutLogList');
            logList.innerHTML = '';

            const workouts = Object.entries(completedWorkouts)
                .sort((a, b) => b[0].localeCompare(a[0]))
                .slice(0, 10);

            if (workouts.length === 0) {
                logList.innerHTML = '<div class="no-data">No workouts logged yet. Click "‚úÖ Complete Workout" after finishing a workout!</div>';
                return;
            }

            workouts.forEach(([date, workout]) => {
                const entry = document.createElement('div');
                entry.className = 'workout-log-entry';
                entry.style.cursor = 'pointer';
                entry.title = 'Click to edit this workout';
                
                const dateObj = new Date(date + 'T00:00:00');
                const formattedDate = dateObj.toLocaleDateString('en-US', { 
                    weekday: 'short', 
                    month: 'short', 
                    day: 'numeric',
                    year: 'numeric'
                });

                entry.innerHTML = `
                    <div class="workout-log-date">${formattedDate}</div>
                    <div class="workout-log-details">Week ${workout.week}, Workout ${workout.day}</div>
                `;
                
                // Make clickable to edit
                entry.onclick = () => selectDate(date);
                
                logList.appendChild(entry);
            });
        }

        // Trends functions
        function updateProgress() {
            // Just update the overview stats
            updateTrendsOverview();
        }

        function updateTrendsOverview() {
            // Calculate total stats from all completed workouts
            let totalWorkouts = 0;
            let totalWeightLifted = 0; // in pounds
            let totalReps = 0;
            let totalSets = 0;
            const heaviestLifts = {}; // { exerciseName: { weight, date } }
            const ninetyDaysAgo = new Date();
            ninetyDaysAgo.setDate(ninetyDaysAgo.getDate() - 90);

            // Go through all completed workouts
            Object.keys(completedWorkouts).sort().forEach(date => {
                const workout = completedWorkouts[date];
                const workoutKey = `week${workout.week}_day${workout.day}`;
                const workoutDataForDay = workoutData[workoutKey];

                if (workoutDataForDay) {
                    totalWorkouts++;
                    const weekData = programData[workout.week];
                    const exercises = weekData.workouts[workout.day].exercises;

                    exercises.forEach((exercise, index) => {
                        const data = workoutDataForDay[index];
                        if (data && data.included !== false) {
                            const weight = data.weight || 0;
                            const reps = data.reps || 0;
                            const sets = data.sets || 0;

                            // Only count if weight > 0
                            if (weight > 0) {
                                totalWeightLifted += (weight * reps * sets);
                                totalReps += reps * sets;
                                totalSets += sets;

                                // Track heaviest lifts (last 90 days)
                                const workoutDate = new Date(date);
                                if (workoutDate >= ninetyDaysAgo) {
                                    if (!heaviestLifts[exercise.name] || weight > heaviestLifts[exercise.name].weight) {
                                        heaviestLifts[exercise.name] = {
                                            weight: weight,
                                            date: date,
                                            isTime: exercise.name.toLowerCase().includes('plank')
                                        };
                                    }
                                }
                            }
                        }
                    });
                }
            });

            // Update overview stats display
            document.getElementById('totalWorkouts').textContent = totalWorkouts;
            document.getElementById('totalLifted').textContent = (totalWeightLifted / 2000).toFixed(1); // Convert to tons
            document.getElementById('totalReps').textContent = totalReps.toLocaleString();
            document.getElementById('totalSets').textContent = totalSets.toLocaleString();

            // Update goal progress
            updateGoalProgress(heaviestLifts);

            // Update heaviest lifts display
            updateHeaviestLifts(heaviestLifts);
        }

        function updateGoalProgress(heaviestLifts) {
            // Bench Press goal: 225 lbs
            const benchGoal = 225;
            const benchCurrent = heaviestLifts['Bench Press'] ? heaviestLifts['Bench Press'].weight : 0;
            const benchPercent = Math.min(Math.round((benchCurrent / benchGoal) * 100), 100);

            // Back Squat goal: 300 lbs
            const squatGoal = 300;
            const squatCurrent = heaviestLifts['Back Squat'] ? heaviestLifts['Back Squat'].weight : 0;
            const squatPercent = Math.min(Math.round((squatCurrent / squatGoal) * 100), 100);

            // Update text
            document.getElementById('benchPercent').textContent = benchPercent + '%';
            document.getElementById('benchCurrent').textContent = benchCurrent + ' lbs';
            document.getElementById('squatPercent').textContent = squatPercent + '%';
            document.getElementById('squatCurrent').textContent = squatCurrent + ' lbs';

            // Update circular progress
            const circumference = 2 * Math.PI * 52; // radius = 52
            
            const benchOffset = circumference - (benchPercent / 100) * circumference;
            document.getElementById('benchCircle').style.strokeDashoffset = benchOffset;

            const squatOffset = circumference - (squatPercent / 100) * circumference;
            document.getElementById('squatCircle').style.strokeDashoffset = squatOffset;
        }

        function updateHeaviestLifts(heaviestLifts) {
            const grid = document.getElementById('heaviestGrid');
            
            if (Object.keys(heaviestLifts).length === 0) {
                grid.innerHTML = '<div style="text-align: center; color: #6c757d; grid-column: 1/-1;">Complete workouts to track your heaviest lifts</div>';
                return;
            }

            // Sort by weight descending
            const sortedLifts = Object.entries(heaviestLifts)
                .sort((a, b) => b[1].weight - a[1].weight);

            grid.innerHTML = sortedLifts.map(([name, data]) => {
                const displayWeight = data.isTime ? `${data.weight} sec` : `${data.weight} lbs`;
                const displayDate = new Date(data.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                return `
                    <div class="heaviest-item">
                        <div class="heaviest-exercise">${name}</div>
                        <div class="heaviest-weight">${displayWeight}</div>
                        <div class="heaviest-date">${displayDate}</div>
                    </div>
                `;
            }).join('');
        }


        // Initialize app when page loads
        window.onload = initializeApp;

        // Update detection and service worker management
        let updateAvailable = false;

        function applyUpdate() {
            // Show loading message
            const banner = document.getElementById('updateBanner');
            banner.innerHTML = '<div class="update-message"><span>‚è≥ Updating app...</span></div>';
            
            // Wait a moment for user to see the message, then reload
            setTimeout(() => {
                window.location.reload(true); // Force reload from server
            }, 500);
        }

        function showUpdateBanner() {
            const banner = document.getElementById('updateBanner');
            banner.classList.add('show');
            updateAvailable = true;
        }

        // Register service worker for PWA functionality
        if ('serviceWorker' in navigator) {
            let refreshing = false;

            // Detect when new service worker is waiting
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (refreshing) return;
                refreshing = true;
                window.location.reload();
            });

            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => {
                        console.log('Service Worker registered');

                        // Check for updates every time the page loads
                        reg.update();

                        // Listen for updates
                        reg.addEventListener('updatefound', () => {
                            const newWorker = reg.installing;
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New service worker available
                                    showUpdateBanner();
                                }
                            });
                        });
                    })
                    .catch(err => console.log('Service Worker registration failed:', err));

                // Listen for messages from service worker
                navigator.serviceWorker.addEventListener('message', event => {
                    if (event.data && event.data.type === 'UPDATE_AVAILABLE') {
                        showUpdateBanner();
                    }
                });
            });

            // Check for updates every 5 minutes while app is open
            setInterval(() => {
                if (navigator.serviceWorker.controller) {
                    navigator.serviceWorker.getRegistration().then(reg => {
                        if (reg) reg.update();
                    });
                }
            }, 5 * 60 * 1000); // 5 minutes
        }
    </script>
</body>
</html>