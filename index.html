<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strength Tracker</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="20-Week Strength Training Program Tracker">
    <meta name="theme-color" content="#CC5500">
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS Specific Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Strength Tracker">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #001f3f 0%, #003366 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #CC5500 0%, #ff6a00 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: #f8f9fa;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            color: #495057;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: white;
            color: #CC5500;
            border-bottom: 3px solid #CC5500;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        /* Workout Tracker Styles */
        .controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .controls label {
            font-weight: 600;
            color: #495057;
        }

        .controls select {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            cursor: pointer;
        }

        .week-info {
            background: #001f3f;
            border-left: 4px solid #CC5500;
            padding: 15px 20px;
            margin-bottom: 25px;
            border-radius: 8px;
        }

        .week-info h2 {
            color: white;
            font-size: 24px;
            margin-bottom: 8px;
        }

        .week-info p {
            color: rgba(255, 255, 255, 0.9);
        }

        .exercise-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .exercise-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .exercise-card.completed {
            border-color: #28a745;
            background: #f8fff9;
        }

        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .exercise-name {
            font-size: 18px;
            font-weight: 700;
            color: #001f3f;
        }

        .exercise-details {
            font-size: 14px;
            color: #6c757d;
            margin-top: 5px;
        }

        .dial-container {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }

        .dial {
            flex: 1;
            text-align: center;
        }

        .dial-label {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .dial-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .dial-button {
            width: 40px;
            height: 40px;
            border: 2px solid #CC5500;
            background: white;
            color: #CC5500;
            border-radius: 50%;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dial-button:hover {
            background: #CC5500;
            color: white;
        }

        .dial-value {
            font-size: 24px;
            font-weight: bold;
            color: #001f3f;
            min-width: 60px;
        }

        /* Calendar Styles */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-header h3 {
            font-size: 24px;
            color: #001f3f;
        }

        .month-nav {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .month-nav button {
            padding: 8px 15px;
            background: #CC5500;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .month-nav button:hover {
            background: #ff6a00;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 30px;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: 700;
            color: #001f3f;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .calendar-day {
            aspect-ratio: 1;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 8px;
            text-align: center;
            background: white;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }

        .calendar-day:hover {
            border-color: #CC5500;
            box-shadow: 0 2px 8px rgba(204, 85, 0, 0.2);
        }

        .calendar-day.other-month {
            opacity: 0.3;
        }

        .calendar-day.today {
            border-color: #001f3f;
            border-width: 3px;
        }

        .calendar-day.has-workout {
            background: linear-gradient(135deg, #CC5500 0%, #ff6a00 100%);
            color: white;
            border-color: #CC5500;
        }

        .calendar-day-number {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .calendar-day-workout {
            font-size: 10px;
            font-weight: 600;
            background: rgba(255, 255, 255, 0.3);
            padding: 2px 4px;
            border-radius: 4px;
            margin-top: 4px;
        }

        .workout-log {
            margin-top: 30px;
        }

        .workout-log h4 {
            color: #001f3f;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .workout-log-entry {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #CC5500;
        }

        .workout-log-date {
            font-weight: 700;
            color: #001f3f;
            margin-bottom: 5px;
        }

        .workout-log-details {
            color: #6c757d;
            font-size: 14px;
        }

        /* Trends Styles */
        .trends-controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .trends-controls label {
            font-weight: 600;
            color: #495057;
            margin-right: 10px;
        }

        .trends-controls select {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            cursor: pointer;
        }

        .chart-container {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .chart-title {
            font-size: 20px;
            font-weight: 700;
            color: #001f3f;
            margin-bottom: 20px;
        }

        canvas {
            max-width: 100%;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #28a745;
            color: white;
        }

        .btn-primary:hover {
            background: #218838;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .notes-area {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            margin-top: 15px;
            resize: vertical;
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí™ Strength Tracker</h1>
            <p>20-Week Program ‚Ä¢ Bench: 185‚Üí225 lbs ‚Ä¢ Squat: 225‚Üí300 lbs</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('tracker')">üèãÔ∏è Workout</button>
            <button class="tab" onclick="switchTab('calendar')">üìÖ Calendar</button>
            <button class="tab" onclick="switchTab('trends')">üìà Trends</button>
        </div>

        <!-- WORKOUT TRACKER TAB -->
        <div id="tracker" class="tab-content active">
            <div class="controls">
                <div>
                    <label>Week:</label>
                    <select id="weekSelect" onchange="updateWorkout()"></select>
                </div>
                <div>
                    <label>Workout Day:</label>
                    <select id="daySelect" onchange="updateWorkout()"></select>
                </div>
            </div>

            <div class="week-info">
                <h2 id="workoutTitle"></h2>
                <p id="workoutSubtitle"></p>
            </div>

            <div id="exercisesContainer"></div>

            <textarea class="notes-area" id="workoutNotes" placeholder="Workout notes..." onchange="updateNotes(this.value)"></textarea>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="saveWorkout()">üíæ Save Progress</button>
                <button class="btn btn-secondary" onclick="clearWorkout()">üóëÔ∏è Clear Workout</button>
                <button class="btn btn-primary" onclick="markWorkoutComplete()">‚úÖ Complete Workout</button>
            </div>
        </div>

        <!-- CALENDAR TAB -->
        <div id="calendar" class="tab-content">
            <div class="calendar-header">
                <h3 id="calendarMonth"></h3>
                <div class="month-nav">
                    <button onclick="changeMonth(-1)">‚óÄ Prev</button>
                    <button onclick="changeMonth(0)">Today</button>
                    <button onclick="changeMonth(1)">Next ‚ñ∂</button>
                </div>
            </div>

            <div class="calendar-grid" id="calendarGrid"></div>

            <div class="workout-log">
                <h4>Recent Workouts</h4>
                <div id="workoutLogList"></div>
            </div>
        </div>

        <!-- TRENDS TAB -->
        <div id="trends" class="tab-content">
            <div class="trends-controls">
                <label>Select Exercise:</label>
                <select id="exerciseSelect" onchange="updateTrends()">
                    <option value="">-- Select Exercise --</option>
                </select>
            </div>

            <div id="trendsContainer">
                <div class="no-data">
                    <p>Select an exercise to view weight progression trends</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Program data structure
        const programData = {
            1: {
                phase: "Foundation",
                workouts: {
                    A: {
                        focus: "Upper Body",
                        exercises: [
                            { name: "Bench Press", sets: "4x8", weight: "130 lbs", reps: 8 },
                            { name: "Incline Dumbbell Press", sets: "3x10", weight: "35 lbs each", reps: 10 },
                            { name: "Close-Grip Bench Press", sets: "3x8", weight: "110 lbs", reps: 8 },
                            { name: "Barbell Rows", sets: "4x8", weight: "135 lbs", reps: 8 },
                            { name: "Lat Pulldowns", sets: "3x10", weight: "120 lbs", reps: 10 },
                            { name: "Dumbbell Shoulder Press", sets: "3x10", weight: "30 lbs each", reps: 10 },
                            { name: "Dumbbell Curls", sets: "3x12", weight: "25 lbs each", reps: 12 },
                            { name: "Plank", sets: "3x60s", weight: "60 sec", reps: 1 }
                        ]
                    },
                    B: {
                        focus: "Lower Body",
                        exercises: [
                            { name: "Back Squat", sets: "4x8", weight: "160 lbs", reps: 8 },
                            { name: "Romanian Deadlift", sets: "3x8", weight: "185 lbs", reps: 8 },
                            { name: "Leg Press", sets: "3x12", weight: "270 lbs", reps: 12 },
                            { name: "Bulgarian Split Squats", sets: "3x10 each", weight: "30 lbs each", reps: 10 },
                            { name: "Leg Curls", sets: "3x12", weight: "80 lbs", reps: 12 },
                            { name: "Calf Raises", sets: "4x15", weight: "135 lbs", reps: 15 },
                            { name: "Ab Wheel Rollouts", sets: "3x10", weight: "bodyweight", reps: 10 }
                        ]
                    }
                }
            }
        };

        // Clone week 1 for all 20 weeks (can be customized later)
        for (let i = 2; i <= 20; i++) {
            let phase = "Foundation";
            if (i >= 5 && i <= 8) phase = "Hypertrophy";
            else if (i >= 9 && i <= 12) phase = "Strength Building";
            else if (i >= 13 && i <= 16) phase = "Power Development";
            else if (i >= 17) phase = "Peaking";
            
            programData[i] = {
                phase: phase,
                workouts: JSON.parse(JSON.stringify(programData[1].workouts))
            };
        }

        let workoutData = {};
        let completedWorkouts = {}; // { "2025-11-15": { week: 1, day: "A" } }
        let currentWeek = 1;
        let currentDay = 'A';
        let currentCalendarDate = new Date();

        function initializeApp() {
            loadProgress();
            populateWeekSelect();
            populateExerciseSelect();
            updateWorkout();
            renderCalendar();
            updateWorkoutLog();
        }

        function populateWeekSelect() {
            const select = document.getElementById('weekSelect');
            for (let i = 1; i <= 20; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `Week ${i}`;
                select.appendChild(option);
            }
            select.value = currentWeek;
        }

        function populateExerciseSelect() {
            const select = document.getElementById('exerciseSelect');
            const exercises = new Set();
            
            // Collect all unique exercises
            Object.values(programData).forEach(week => {
                Object.values(week.workouts).forEach(workout => {
                    workout.exercises.forEach(ex => exercises.add(ex.name));
                });
            });

            exercises.forEach(ex => {
                const option = document.createElement('option');
                option.value = ex;
                option.textContent = ex;
                select.appendChild(option);
            });
        }

        function updateWorkout() {
            const weekSelect = document.getElementById('weekSelect');
            const daySelect = document.getElementById('daySelect');
            
            currentWeek = parseInt(weekSelect.value);
            currentDay = daySelect.value || 'A';

            // Update day select options
            if (daySelect.options.length === 0) {
                ['A', 'B'].forEach(day => {
                    const option = document.createElement('option');
                    option.value = day;
                    option.textContent = `Workout ${day}`;
                    daySelect.appendChild(option);
                });
            }

            const weekData = programData[currentWeek];
            const workoutInfo = weekData.workouts[currentDay];

            document.getElementById('workoutTitle').textContent = 
                `Week ${currentWeek} - ${weekData.phase}, Workout ${currentDay}`;
            document.getElementById('workoutSubtitle').textContent = 
                `Focus: ${workoutInfo.focus}`;

            renderExercises(workoutInfo.exercises);
            loadWorkoutData();
        }

        function renderExercises(exercises) {
            const container = document.getElementById('exercisesContainer');
            container.innerHTML = '';

            exercises.forEach((exercise, index) => {
                const card = document.createElement('div');
                card.className = 'exercise-card';
                card.id = `exercise-${index}`;

                const isPlank = exercise.name.toLowerCase().includes('plank');
                const weightLabel = isPlank ? 'Time (sec)' : 'Weight (lbs)';
                const weightIncrement = isPlank ? 5 : 5;

                card.innerHTML = `
                    <div class="exercise-header">
                        <div>
                            <div class="exercise-name">${exercise.name}</div>
                            <div class="exercise-details">Target: ${exercise.sets}</div>
                        </div>
                    </div>
                    <div class="dial-container">
                        <div class="dial">
                            <div class="dial-label">${weightLabel}</div>
                            <div class="dial-controls">
                                <button class="dial-button" onclick="adjustValue(${index}, 'weight', -${weightIncrement})">‚àí</button>
                                <div class="dial-value" id="weight-${index}">0</div>
                                <button class="dial-button" onclick="adjustValue(${index}, 'weight', ${weightIncrement})">+</button>
                            </div>
                        </div>
                        <div class="dial">
                            <div class="dial-label">Reps</div>
                            <div class="dial-controls">
                                <button class="dial-button" onclick="adjustValue(${index}, 'reps', -1)">‚àí</button>
                                <div class="dial-value" id="reps-${index}">0</div>
                                <button class="dial-button" onclick="adjustValue(${index}, 'reps', 1)">+</button>
                            </div>
                        </div>
                        <div class="dial">
                            <div class="dial-label">Sets</div>
                            <div class="dial-controls">
                                <button class="dial-button" onclick="adjustValue(${index}, 'sets', -1)">‚àí</button>
                                <div class="dial-value" id="sets-${index}">0</div>
                                <button class="dial-button" onclick="adjustValue(${index}, 'sets', 1)">+</button>
                            </div>
                        </div>
                    </div>
                `;

                container.appendChild(card);
            });
        }

        function loadWorkoutData() {
            const workoutKey = `week${currentWeek}_day${currentDay}`;
            const data = workoutData[workoutKey] || {};
            
            const weekData = programData[currentWeek];
            const exercises = weekData.workouts[currentDay].exercises;

            exercises.forEach((exercise, index) => {
                const exerciseData = data[index] || { weight: 0, reps: 0, sets: 0 };
                
                document.getElementById(`weight-${index}`).textContent = exerciseData.weight || 0;
                document.getElementById(`reps-${index}`).textContent = exerciseData.reps || 0;
                document.getElementById(`sets-${index}`).textContent = exerciseData.sets || 0;

                // Mark as completed if all values > 0
                if (exerciseData.weight > 0 && exerciseData.reps > 0 && exerciseData.sets > 0) {
                    document.getElementById(`exercise-${index}`).classList.add('completed');
                }
            });

            document.getElementById('workoutNotes').value = data.notes || '';
        }

        function adjustValue(index, field, change) {
            const workoutKey = `week${currentWeek}_day${currentDay}`;
            if (!workoutData[workoutKey]) workoutData[workoutKey] = {};
            if (!workoutData[workoutKey][index]) workoutData[workoutKey][index] = { weight: 0, reps: 0, sets: 0 };

            let currentValue = workoutData[workoutKey][index][field] || 0;
            currentValue += change;

            const weekData = programData[currentWeek];
            const exercise = weekData.workouts[currentDay].exercises[index];
            const isPlank = exercise.name.toLowerCase().includes('plank');

            // Apply limits
            if (field === 'weight') {
                const maxValue = isPlank ? 300 : 350;
                if (currentValue < 0) currentValue = 0;
                if (currentValue > maxValue) currentValue = maxValue;
            } else if (field === 'reps') {
                if (currentValue < 0) currentValue = 0;
                if (currentValue > 20) currentValue = 20;
            } else if (field === 'sets') {
                if (currentValue < 0) currentValue = 0;
                if (currentValue > 10) currentValue = 10;
            }

            workoutData[workoutKey][index][field] = currentValue;
            document.getElementById(`${field}-${index}`).textContent = currentValue;

            // Update completed status
            const exerciseData = workoutData[workoutKey][index];
            if (exerciseData.weight > 0 && exerciseData.reps > 0 && exerciseData.sets > 0) {
                document.getElementById(`exercise-${index}`).classList.add('completed');
            } else {
                document.getElementById(`exercise-${index}`).classList.remove('completed');
            }

            saveProgress();
        }

        function updateNotes(value) {
            const workoutKey = `week${currentWeek}_day${currentDay}`;
            if (!workoutData[workoutKey]) workoutData[workoutKey] = {};
            workoutData[workoutKey].notes = value;
            saveProgress();
        }

        function saveWorkout() {
            saveProgress();
            alert('‚úÖ Progress saved successfully!');
        }

        function clearWorkout() {
            if (confirm('Are you sure you want to clear this workout? This cannot be undone.')) {
                const workoutKey = `week${currentWeek}_day${currentDay}`;
                delete workoutData[workoutKey];
                saveProgress();
                updateWorkout();
            }
        }

        function markWorkoutComplete() {
            const today = new Date().toISOString().split('T')[0];
            completedWorkouts[today] = {
                week: currentWeek,
                day: currentDay,
                date: today
            };
            saveProgress();
            renderCalendar();
            updateWorkoutLog();
            alert(`‚úÖ Workout marked as complete for ${today}!`);
        }

        function saveProgress() {
            localStorage.setItem('workoutTrackerData', JSON.stringify(workoutData));
            localStorage.setItem('completedWorkouts', JSON.stringify(completedWorkouts));
        }

        function loadProgress() {
            const saved = localStorage.getItem('workoutTrackerData');
            if (saved) workoutData = JSON.parse(saved);
            
            const completed = localStorage.getItem('completedWorkouts');
            if (completed) completedWorkouts = JSON.parse(completed);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');

            if (tabName === 'calendar') {
                renderCalendar();
                updateWorkoutLog();
            } else if (tabName === 'trends') {
                updateTrends();
            }
        }

        // Calendar functions
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();

            document.getElementById('calendarMonth').textContent = 
                currentCalendarDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

            // Day headers
            ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                grid.appendChild(header);
            });

            // Get first day of month and number of days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();

            const today = new Date().toISOString().split('T')[0];

            // Previous month days
            for (let i = firstDay - 1; i >= 0; i--) {
                const day = daysInPrevMonth - i;
                const dayDiv = createCalendarDay(day, true, year, month - 1);
                grid.appendChild(dayDiv);
            }

            // Current month days
            for (let day = 1; day <= daysInMonth; day++) {
                const dayDiv = createCalendarDay(day, false, year, month);
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                if (dateStr === today) {
                    dayDiv.classList.add('today');
                }

                if (completedWorkouts[dateStr]) {
                    dayDiv.classList.add('has-workout');
                    const workout = completedWorkouts[dateStr];
                    const workoutLabel = document.createElement('div');
                    workoutLabel.className = 'calendar-day-workout';
                    workoutLabel.textContent = `W${workout.week}${workout.day}`;
                    dayDiv.appendChild(workoutLabel);
                }

                grid.appendChild(dayDiv);
            }

            // Next month days
            const remainingDays = 42 - (firstDay + daysInMonth);
            for (let day = 1; day <= remainingDays; day++) {
                const dayDiv = createCalendarDay(day, true, year, month + 1);
                grid.appendChild(dayDiv);
            }
        }

        function createCalendarDay(day, otherMonth, year, month) {
            const dayDiv = document.createElement('div');
            dayDiv.className = 'calendar-day';
            if (otherMonth) dayDiv.classList.add('other-month');

            const dayNumber = document.createElement('div');
            dayNumber.className = 'calendar-day-number';
            dayNumber.textContent = day;
            dayDiv.appendChild(dayNumber);

            return dayDiv;
        }

        function changeMonth(direction) {
            if (direction === 0) {
                currentCalendarDate = new Date();
            } else {
                currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
            }
            renderCalendar();
        }

        function updateWorkoutLog() {
            const logList = document.getElementById('workoutLogList');
            logList.innerHTML = '';

            const workouts = Object.entries(completedWorkouts)
                .sort((a, b) => b[0].localeCompare(a[0]))
                .slice(0, 10);

            if (workouts.length === 0) {
                logList.innerHTML = '<div class="no-data">No workouts logged yet</div>';
                return;
            }

            workouts.forEach(([date, workout]) => {
                const entry = document.createElement('div');
                entry.className = 'workout-log-entry';
                
                const formattedDate = new Date(date + 'T00:00:00').toLocaleDateString('en-US', { 
                    weekday: 'short', 
                    month: 'short', 
                    day: 'numeric',
                    year: 'numeric'
                });

                entry.innerHTML = `
                    <div class="workout-log-date">${formattedDate}</div>
                    <div class="workout-log-details">Week ${workout.week}, Workout ${workout.day}</div>
                `;
                logList.appendChild(entry);
            });
        }

        // Trends functions
        function updateTrends() {
            const exerciseSelect = document.getElementById('exerciseSelect');
            const selectedExercise = exerciseSelect.value;
            const container = document.getElementById('trendsContainer');

            if (!selectedExercise) {
                container.innerHTML = '<div class="no-data"><p>Select an exercise to view weight progression trends</p></div>';
                return;
            }

            // Collect all data points for the selected exercise
            const dataPoints = [];

            Object.keys(completedWorkouts).sort().forEach(date => {
                const workout = completedWorkouts[date];
                const workoutKey = `week${workout.week}_day${workout.day}`;
                const workoutDataForDay = workoutData[workoutKey];

                if (workoutDataForDay) {
                    const weekData = programData[workout.week];
                    const exercises = weekData.workouts[workout.day].exercises;

                    exercises.forEach((exercise, index) => {
                        if (exercise.name === selectedExercise && workoutDataForDay[index]) {
                            const data = workoutDataForDay[index];
                            if (data.weight > 0) {
                                dataPoints.push({
                                    date: date,
                                    weight: data.weight,
                                    reps: data.reps,
                                    sets: data.sets,
                                    week: workout.week,
                                    day: workout.day
                                });
                            }
                        }
                    });
                }
            });

            if (dataPoints.length === 0) {
                container.innerHTML = `<div class="no-data"><p>No data recorded yet for ${selectedExercise}</p></div>`;
                return;
            }

            // Render the trend chart
            container.innerHTML = `
                <div class="chart-container">
                    <div class="chart-title">${selectedExercise} - Weight Progression</div>
                    <canvas id="trendChart" width="800" height="400"></canvas>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #CC5500;"></div>
                            <span>Weight (lbs)</span>
                        </div>
                    </div>
                </div>
            `;

            drawTrendChart(dataPoints, selectedExercise);
        }

        function drawTrendChart(dataPoints, exerciseName) {
            const canvas = document.getElementById('trendChart');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            // Clear canvas
            ctx.clearRect(0, 0, width, height);

            // Set up padding
            const padding = { top: 40, right: 40, bottom: 60, left: 60 };
            const chartWidth = width - padding.left - padding.right;
            const chartHeight = height - padding.top - padding.bottom;

            // Find min/max values
            const weights = dataPoints.map(d => d.weight);
            const minWeight = Math.min(...weights);
            const maxWeight = Math.max(...weights);
            const weightRange = maxWeight - minWeight || 10;

            // Draw axes
            ctx.strokeStyle = '#dee2e6';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding.left, padding.top);
            ctx.lineTo(padding.left, height - padding.bottom);
            ctx.lineTo(width - padding.right, height - padding.bottom);
            ctx.stroke();

            // Draw grid lines
            ctx.strokeStyle = '#f8f9fa';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding.top + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding.left, y);
                ctx.lineTo(width - padding.right, y);
                ctx.stroke();
            }

            // Y-axis labels
            ctx.fillStyle = '#495057';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'right';
            for (let i = 0; i <= 5; i++) {
                const value = maxWeight - (weightRange / 5) * i + (weightRange * 0.1);
                const y = padding.top + (chartHeight / 5) * i;
                ctx.fillText(Math.round(value) + ' lbs', padding.left - 10, y + 4);
            }

            // X-axis labels
            ctx.textAlign = 'center';
            dataPoints.forEach((point, i) => {
                if (i % Math.ceil(dataPoints.length / 6) === 0) {
                    const x = padding.left + (chartWidth / (dataPoints.length - 1)) * i;
                    const date = new Date(point.date + 'T00:00:00');
                    const label = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    ctx.fillText(label, x, height - padding.bottom + 20);
                }
            });

            // Draw line
            ctx.strokeStyle = '#CC5500';
            ctx.lineWidth = 3;
            ctx.beginPath();

            dataPoints.forEach((point, i) => {
                const x = padding.left + (chartWidth / (dataPoints.length - 1)) * i;
                const normalizedWeight = (point.weight - minWeight + (weightRange * 0.1)) / (weightRange * 1.2);
                const y = height - padding.bottom - (normalizedWeight * chartHeight);

                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();

            // Draw points
            ctx.fillStyle = '#CC5500';
            dataPoints.forEach((point, i) => {
                const x = padding.left + (chartWidth / (dataPoints.length - 1)) * i;
                const normalizedWeight = (point.weight - minWeight + (weightRange * 0.1)) / (weightRange * 1.2);
                const y = height - padding.bottom - (normalizedWeight * chartHeight);

                ctx.beginPath();
                ctx.arc(x, y, 5, 0, 2 * Math.PI);
                ctx.fill();

                // Tooltip on hover (simplified - just show value on point)
                ctx.fillStyle = '#495057';
                ctx.font = 'bold 11px sans-serif';
                ctx.textAlign = 'center';
                if (i === 0 || i === dataPoints.length - 1 || i % Math.ceil(dataPoints.length / 4) === 0) {
                    ctx.fillText(point.weight + ' lbs', x, y - 12);
                }
                ctx.fillStyle = '#CC5500';
            });

            // Chart title
            ctx.fillStyle = '#001f3f';
            ctx.font = 'bold 16px sans-serif';
            ctx.textAlign = 'left';
            ctx.fillText(`Total workouts: ${dataPoints.length}`, padding.left, 25);
        }

        // Initialize app when page loads
        window.onload = initializeApp;

        // Register service worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed'));
            });
        }
    </script>
</body>
</html>
